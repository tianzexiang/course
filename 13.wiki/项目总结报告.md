# 背景
本项目是一个信息流社交应用，代号 FeedApp。使用 create-react-app 脚手架创建工程，使用前后端分离的开发模式。它的前端基于React和
TypeScript实现，服务端基于Koa + MongoDB + TypeScript编写。项目的开发已经基本完成，写此项目开发总结报告，以方便我们在以后的项目开发
中来更好的实施项目的订制开发，让我们在今后的项目开发中有更多有据的资料来规范我们的项目开发过程和提高我们的开发效率。
# 项目详情
## 项目成果

经过我们小组各位成员三个星期以来的共同努力协作，FeedApp已经很好的完成了业务流需求。经过对实机体验以及对软件使用过程的观察，此项目的开发还是比较完善。各方面功能都达到了较好的完成效果，在基础功能之上，注意细节的考量，增加了相对更好的用户体验。

## 核心功能的实现

**帖子**

用户可以发布独立的帖子，删除自己的帖子，也可以评论、转发、喜欢别人的帖子。

**个人中心**

用户可以修改自己的个人信息，可以查看自己的帖子以及喜欢的帖子

**关注**

用户可以互相关注，被关注用户的帖子、转发、回复内容会出现在自己的信息流中

**通知**

用户被关注、评论或者转发了帖子，会收到通知，使用轮询方式

**私信**

用户之间可以互发私信，支持单方面删除，使用轮询的方式支持同步通信

## 代码规范化和无障碍交流

代码规范化书写一方面保证了代码的健壮性减少bug产生，一方面也增强了代码可读性来方便团队成员阅读非自己书写的代码，从而确保无障碍交流。换言
之，好的无障碍交流就要有一定的规范。
因此在项目开始时，组内讨论选取了相对较好的项目代码规范，以及配置Eslint和prettier来格式化代码，小组内共同讨论了所有前后端的api接口设计以及数据结构，共同分析相关功能的实现，制定相关规范，并结合实际的需求，编写了一个简单的api接口设计文档。

## Git协同工作

每日检查、每周检查项目进展和提交。

使用Git协作管理项目。小组成员创建以自己名字拼音命名的开发分支，完成一部分功能后发起 pull request 由组长来合并代码。

如果在提交之前遇到有成员提交，应先拉下最新的代码，解决冲突后上传。

# 项目参与人员
- 黄世隽：主要负责帖子的所有功能的前后端实现，搜索的功能实现，完善项目的细节处理部分和许多提升用户体验的逻辑以及动效部分。

- 田泽翔：主要负责用户相关所有功能的前后端实现，搭建主要的项目框架、微信登录认证、图片裁剪以及帮助完成项目许多复杂的逻辑部分。

- 何英豪：主要负责通知和私信模块业务的前后端实现，很好的完成了发送私信时遇到的各种情况的处理以及帮助处理许多数据库复杂的聚合逻辑。

感谢项目小组所有成员对日常开发和相处过程中的热心帮助以及共同协作。

同时感谢蒋士顺老师和郑永可老师以及涂安龙助教在项目开发过程中对于我们项目中的存在问题的悉心指导和热心解答。

同时感谢周围共同学习的同学们帮忙积极测试以及帮助提出修改方向。

# 项目亮点
## 数据结构的设计

项目初期，小组共同讨论了数据结构的设计，集思广益，设计出了一套较好的方案，周三老师讲解数据结构时，老师的提供的数据结构参考意外的与我们小组设计的数据结构一致，我们设计的数据结构相对于老师的更完善些，还提供了涉及每条对话的数据结构，但是之后老师提出的相关需求使得我们可以简化了设计，不需要实现一些复杂的功能。

## 组件封装和复用

项目过程中，不可避免的遇到了很多组件以及逻辑复用的情况。组内封装了许多通用组件，它们易维护、易扩展、易复用、灵活性好，复用性高。体现了面向对象中高内聚，低耦合的特点。如封装了下拉加载更多和下拉刷新的组件，只需要传入几个参数，就可以实现用同一个组件去渲染不同的列表，以及项目中使用的各种工具类函数。

## 用户体验

项目后期，除了完善项目主要功能，我们还在从用户的层面出发，为用户考虑，遵循UI/UX设计原则，在用户的感知以及用户反馈的体验上尽量做到最佳。
用户在足够清晰的界面环境中能够轻松操作，产品逻辑清晰，用户体验良好。

具体表现在：

1. 当用户在非主页其他页面发布自己的帖子时，不止会有发布成功的Toast提示，左下角导航栏也会有相应的小圆点提示。
2. 当用户在发帖之后，由于图片上传至阿里云OSS时间较久，我们采用了图片暂存本地的方法，在用户发帖时，新帖展示的是本地上传的图片，而不是阿里云OSS返回的链接。这种方法使得用户发帖之后不需要等待图片上传，可以直接看到发布的新帖，而图片会在后台默默上传。
3. 当用户在聊天界面的浏览以往的聊天记录时，如果此时有新消息的传入，我们做了“新消息”的提示。在获取新列表的同时，不会影响用户正在浏览的聊天记录，但是会给予提示，用户可以通过点击气泡，迅速定位至新消息。
4. 当用户进行搜索时，进行了搜索的输入防抖处理，用户在搜索栏中输入时，如果超过一定时间没有继续输入，输入框将会自动搜索发送请求，减少用户的输入，确保每次操作的有效性，可以有效提升用户对产品的信任感和满意度。
5. 提高点击的有效性，但是又不给予服务器过大的压力，当用户在点击点赞时，进行防抖处理，但是在用户的每一次点击的时候都会给予反馈，使得用户不会觉得自己的点击是无效的，减少用户的挫败感。通俗易懂的话就是用户对喜爱的帖子疯狂重复点赞的同时，每一次点击都会给予动效反馈，但是只在用户最后一次点击的时候发送请求。
6. 用户在浏览帖子的评论的时候，会将tab栏以及主贴内容简化到最小，保留基本的信息以及返回按钮，使得用户可以沉浸在浏览评论的内容之中。预览图片时，提供质量为20的图片，用户可以通过点击来预览质量为60的图片，通过点击查看原图来获得质量为100的原图。
7. 用户在个人中心浏览自己的帖子列表的时候，同样也会将帖子列表以外的内容简化，保留可切换的tab栏。
8. 错误预防：用户在删除重要的信息时，会给予用户鲜明的提示信息，防止用户错删信息。
9. 网速较慢情况下的骨架屏动画、button loading动画、页面切换时数据加载动画。
10. 减轻用户记忆负担：系统界面功能简洁明确，一目了然，没有冗余功能，易于用户快速上手使用。
11. 减少用户的多余操作，提供通知一键删除和一键已读的功能，以及私信一键已读。
12. 用户发布新帖时，考虑到用户的输入体验，设置了最小高度和最大高度，处理了图片的展示，以及超出字符限制的提示等

# 项目不足
1. web socket：由于项目开发周期较短，考虑到实现此功能需要新学一些不可预知的知识，没有使用web socket进行实时通信，但是运用轮询对服务端进行请求也能有不错的效果。

# 遇到的问题

1. 聊天页面布局问题，去看了下infiniteScroll源码，感觉思路相似，但是很明显那边处理的情况更多更详细，想要依次复现改动有些困难，所以另求办法。下拉加载更多最先思路是判断scrollTop，监听scroll滚动。但这样有两个问题，一是scrollTop抖动，二是监听scroll滚动性能很差。仔细思索下，想起之前看阮一峰大佬用过一个web api`intersectionObserver`正好可以用来处理当前情况，具体文章信息可以参考[intersectionObserver](https://ruanyifeng.com/blog/2016/11/intersectionobserver_api.html)，其实在react Hook FAQ中也有提到[我该如何测量 DOM 节点？](https://react.docschina.org/docs/hooks-faq.html#how-can-i-measure-a-dom-node)，里面大概讲了`callback ref`，以及`ResizeObserver`。这里问题解决方法基本是找到了，但在react中使用仍有问题。react中的state无法在observer中更新，所以可能需要进一步封装该api使得能够在react中使用。鉴于时间原因，我想是不是会有相关库，于是去npm上利用关键词搜索了一下，果然发现相关库`react-intersection-observer`，在react中尝试使用后，比较完美的实现了下拉加载更多的功能。
2. 图片尺寸不合问题，使用图片裁剪完成，顺便完成前端简单的图片压缩。封装基本图片裁剪组件CropImage，主要是操作canvas将图片data放上去，利用获取到的图像坐标裁剪即可，按照比例裁剪图片同时可以放大缩小图片，利用`toDataURL、toBlob`方法将canvas转换成压缩过后的图片数据。
3. 一开始将获取微信用户信息的接口放到前端去请求，在地址为localhost下没有出现跨域问题。但换成手机以局域网地址登录项目后，出现跨域问题，于是将请求放置后端解决。出现该情况原因是：

  ```
  localhost：本地服务器，不经过网卡传输的，它不受网络防火墙和网卡相关的限制。
  127.0.0.1或局域网地址：域名访问，通过网卡传输的，依赖网卡，并受到网络防火墙和网卡相关的限制。
  ```

4. 获取登录关注列表的同时获取是否相互关注，获取别人关注列表的同时也是或取列表用户与登录用户的关系。解决方案是，分页查询同时通过连自身表查询，传入一个relationId（需要查找关系的用户，一般就是登录用户）。
5. 一些css属性在手机浏览器端不兼容，这个只能找出来修改，但还好用的不多，目前暂无不兼容情况。
6. 个人首页父子滚动容器衔接不够顺滑问题
7. 当网速过慢时导致白屏体验很差，关注按钮点击甚至没有反应，通过封装统一的loading动画以及开启button loading解决。
8. 当脱机时，因为轮询和统一错误处理的原因，导致不停出现错误提示，通过使用throttle控制了toast出现间隔，提醒用户同时不至于过于频繁出现。
9. OSS对象存储改为URL签名上传遇到的上传失败的问题。尝试使用跟据后缀来判断文件类型的方法，但是发现不能解决问题，仍然是报403的错误。最终请教了同学：改为使用Content-Type为Blob来上传。上传需要指定Content-Type为blob，以及文件类型也要转换为blob的二进制形式，最终上传成功，其他类型则会报错。

# 经验与总结
## 项目本身效果分析

经过我们小组各位成员三个星期以来的共同努力协作，合理运用前一个月所学知识，FeedApp已经很好的完成了业务流需求。经过对软件使用过程的观察，此项目的开发还是比较完善。各方面功能都达到了较好的完成效果，在基础功能之上，注意细节的考量，增加了相对更好的用户体验。

## 后续项目可参考的内容

1. 组件封装
2. 代码风格
3. 用户体验
4. 封装的高复用性工具类

## 后续项目需要避免的内容

1. 合理安排进度，避免过度加班。
2. 由于在开发过程中的种种原因，没有考虑周全，可能还是有些代码存在直接复制粘贴使用的部分。在后续的项目中，项目搭建初期应该共同讨论一下公共组件和逻辑的部分。